# ソート
データをソートしたい場合は ORDER BY を使う。

## 問題点
データが多いテーブルをソートする場合、クエリの実行順序的に ORDER BY はほぼ最後に実行されるため、何もしないと全データをスキャンしてからの実行となり処理が重たい。

## 解決策
- WHERE で条件を指定してデータを絞る  
先にデータを絞って、量を減らしておけば、それだけ少ない量でのソートとなり処理を軽くできる。その際にインデックスを利用するといい。
- インデックスを利用する  
PostgreSQL, MySQL は BTree INDEX を使っており、これはソート済みのインデックスとなる。そのため、ORDER BY で必要となるカラムにインデックスを設定しておくとソートする必要がなく、処理が早い。

## その他
### ページャー問題
ページャーを使って一覧を表示する場合、OFFSET で取得することが多い。

OFFSETを使う場合、ページが最初の方は LIMIT の数だけデータを取得すればいいが、ページがあとになればなるほど (ページ数 * LIMIT + LIMIT) の行を見る必要が発生し、処理が重くなる。

この場合、OFFSET を使うのではなく、ソートしているカラムで WHERE をかける。具体的には、「表示したページの最終の id などを取得しておき、それ以上のデータを取得する」とすることで OFFSET が必要なく LIMIT の数だけデータを取ればいいことになる。

## その他の解決策
- データをアプリに渡しておいて、そちらでソート(ただし、データをすべてアプリ側に渡す必要があり、通信やアプリ側の負担が大きくなることがある)
- ソート済みデータをキャッシュしておく(ただし、変更が多いテーブルには不向き)
- NoSQL

選択肢としていろいろなものがあるが、データ量や使用ケースなどに合わせて選択する必要がある。 


参考: [失敗から学ぶRDBの正しい歩き方](https://www.amazon.co.jp/dp/B07P8PMHLL)
