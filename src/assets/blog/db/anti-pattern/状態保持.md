# 状態保持
削除フラグや status(無料会員、有料会員、退会会員など)といった状態をカラムに持たせること

## 問題点
- データを引くときに必ずフラグを考慮する必要が出てきて、クエリが複雑になる
- 状態はカーディナリティが低くなるのでインデックスを使えない可能性がある
- 削除フラグの場合、削除の有無によってデータが2つ作成される可能性があり、ユニーク制約が使えない

## 解決策
事実のみを保存する
- 削除フラグの場合、削除テーブルを作っておいて、削除データをそちらに移行する。元テーブルのデータは削除
- View を使って削除フラグの立っているものを事前に除いておく  
ただし、クエリが楽になるだけで、高速化に作用するわけでない

## その他
どうしても削除フラグを使いたいときは以下に注意する
- 対象テーブルが小さく、インデックスが不要  
データ量が多いとインデックスが必要になってくる場面が多いが使えない
- JOIN の対象になることが少ない  
JOIN のたびにフラグ制約を書く必要があるため。Rails たといい感じにやってくれる gem がある気がする。
- UNIQUE 制約が必要ない  
削除フラグなどによって同じデータを複数持つことができるから


参考: [失敗から学ぶRDBの正しい歩き方](https://www.amazon.co.jp/dp/B07P8PMHLL)

